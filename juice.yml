resource_types:
- name: pull-request
  type: docker-image
  source:
    repository: jtarchie/pr

resources:
- name: juice-examples
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/juice-examples.git

- name: juice
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/juice.git

- name: coaster-nn
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/coaster-nn.git

- name: coaster-blas
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/coaster-blas.git

- name: coaster
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/coaster.git

- name: greenglas
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/greenglas.git

- name: rust-cudnn
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/rust-cudnn.git

- name: rust-cublas
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/rust-cublas.git

- name: rust-blas
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/rust-blas.git
- name: doc-juice
  type: git
  source:
    branch: gh-pages
    uri: git@github.com:spearow/juice.git
    private_key: ((sirmergealot-ssh-key))
    git_config:
    - name: user.email
      value: sirmergealot@spearow.io
    - name: user.name
      value: "Sir Mergealot"

- name: doc-coaster-nn
  type: git
  source:
    branch: gh-pages
    uri: git@github.com:spearow/coaster-nn.git
    private_key: ((sirmergealot-ssh-key))
    git_config:
    - name: user.email
      value: sirmergealot@spearow.io
    - name: user.name
      value: "Sir Mergealot"

- name: doc-coaster-blas
  type: git
  source:
    branch: gh-pages
    uri: git@github.com:spearow/coaster-blas.git
    private_key: ((sirmergealot-ssh-key))
    git_config:
    - name: user.email
      value: sirmergealot@spearow.io
    - name: user.name
      value: "Sir Mergealot"

- name: doc-coaster
  type: git
  source:
    branch: gh-pages
    uri: git@github.com:spearow/coaster.git
    private_key: ((sirmergealot-ssh-key))
    git_config:
    - name: user.email
      value: sirmergealot@spearow.io
    - name: user.name
      value: "Sir Mergealot"

- name: doc-greenglas
  type: git
  source:
    branch: gh-pages
    uri: git@github.com:spearow/greenglas.git
    private_key: ((sirmergealot-ssh-key))
    git_config:
    - name: user.email
      value: sirmergealot@spearow.io
    - name: user.name
      value: "Sir Mergealot"
- name: pr-greenglas
  type: pull-request
  source:
    repo: spearow/greenglas
    access_token: ((sirmergealot-github-token))

- name: pr-coaster-nn
  type: pull-request
  source:
    repo: spearow/coaster-nn
    access_token: ((sirmergealot-github-token))

- name: pr-juice-examples
  type: pull-request
  source:
    repo: spearow/juice-examples
    access_token: ((sirmergealot-github-token))

- name: pr-juice
  type: pull-request
  source:
    repo: spearow/juice
    access_token: ((sirmergealot-github-token))

- name: pr-coaster-blas
  type: pull-request
  source:
    repo: spearow/coaster-blas
    access_token: ((sirmergealot-github-token))

- name: pr-coaster
  type: pull-request
  source:
    repo: spearow/coaster
    access_token: ((sirmergealot-github-token))


- name: pr-rust-cudnn
  type: pull-request
  source:
    repo: spearow/rust-cudnn
    access_token: ((sirmergealot-github-token))

- name: pr-rust-cublas
  type: pull-request
  source:
    repo: spearow/rust-cublas
    access_token: ((sirmergealot-github-token))

- name: pr-rust-blas
  type: pull-request
  source:
    repo: spearow/rust-blas
    access_token: ((sirmergealot-github-token))


- name: container-fedora-cuda
  type: docker-image
  tags: [cuda, nv-compute-cap-3.5]
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-cuda
    username: ((quay-username))
    password: ((quay-password))

- name: container-fedora-default
  type: docker-image
  tags: [cuda, nv-compute-cap-3.5, opencl]
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-default
    username: ((quay-username))
    password: ((quay-password))

- name: container-fedora-native
  type: docker-image
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-native
    username: ((quay-username))
    password: ((quay-password))

- name: container-fedora-opencl
  type: docker-image
  tags: [opencl]
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-opencl
    username: ((quay-username))
    password: ((quay-password))



- name: container-ubuntu-native
  type: docker-image
  source:
    repository: quay.io/spearow/machine-learning-container-ubuntu-native
    username: ((quay-username))
    password: ((quay-password))

- name: container-ubuntu-opencl
  type: docker-image
  tags: [opencl]
  source:
    repository: quay.io/spearow/machine-learning-container-ubuntu-opencl
    username: ((quay-username))
    password: ((quay-password))



- name: container
  type: docker-image
  source:
    repository: quay.io/spearow/machine-learning-container
    username: ((quay-username))
    password: ((quay-password))


groups:
- name: stack
  jobs:
  - test-coaster
  - test-coaster-nn
  - test-coaster-blas
  - test-juice
  - test-juice-examples
  - test-greenglas
  - test-rust-blas
  - test-rust-cudnn
  - test-rust-cublas
- name: documentation
  jobs:
  - doc-coaster
  - doc-coaster-nn
  - doc-coaster-blas
  - doc-greenglas
  - doc-juice
- name: pull-request
  jobs:
  - pr-test-coaster
  - pr-test-coaster-nn
  - pr-test-coaster-blas
  - pr-test-juice
  - pr-test-juice-examples
  - pr-test-greenglas
  - pr-test-rust-blas
  - pr-test-rust-cudnn
  - pr-test-rust-cublas

jobs:
  - name: doc-coaster
    build_logs_to_retain: 2
    public: true
    serial: true
    plan:
    - aggregate:
      - get: doc-coaster
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: container
        trigger: true
    - task: gen-doc
      image: container
      config:
        platform: linux
        inputs:
        - name: coaster
        - name: doc-coaster
        outputs:
        - name: doc-coaster-updated
        run:
          path: sh
          args:
          - -exc
          - |
            cd coaster
            cargo doc --no-deps
            cd -
            git clone doc-coaster doc-coaster-updated
            rm -rf doc-coaster-updated/*
            cp -rf coaster/target/doc/* doc-coaster-updated/
            cd doc-coaster-updated
            echo "<meta http-equiv=refresh content=0;url=coaster/index.html>" > index.html
            git config --global user.email "sirmergealot@spearow.io"
            git config --global user.name "Sir Mergealot"
            git add -A && git commit -m"doc/automatic: update" || true
    - put: doc-coaster
      params: { repository: doc-coaster-updated, force: true }

  - name: doc-coaster-nn
    build_logs_to_retain: 2
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster
      - get: doc-coaster-nn
      - get: coaster-nn
        trigger: true
        passed: [test-coaster-nn]
      - get: container
        trigger: true
    - task: gen-doc
      image: container
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cudnn
        - name: rust-cublas
        - name: coaster
        - name: coaster-nn
        - name: doc-coaster-nn
        outputs:
        - name: doc-coaster-nn-updated
        run:
          path: sh
          args:
          - -exc
          - |
            cd coaster-nn
            cargo doc --no-deps
            cd -
            git clone doc-coaster-nn doc-coaster-nn-updated
            rm -rf doc-coaster-nn-updated/*
            cp -rf coaster-nn/target/doc/* doc-coaster-nn-updated/
            cd doc-coaster-nn-updated
            echo "<meta http-equiv=refresh content=0;url=coaster_nn/index.html>" > index.html
            git config --global user.email "sirmergealot@spearow.io"
            git config --global user.name "Sir Mergealot"
            git add -A && git commit -m"doc/automatic: update" || true
    - put: doc-coaster-nn
      params: { repository: doc-coaster-nn-updated, force: true }

  - name: doc-coaster-blas
    build_logs_to_retain: 2
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster
      - get: doc-coaster-blas
      - get: coaster-blas
        trigger: true
        passed: [test-coaster-blas]
      - get: container
        trigger: true
    - task: gen-doc
      image: container
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cudnn
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: doc-coaster-blas
        outputs:
        - name: doc-coaster-blas-updated
        run:
          path: sh
          args:
          - -exc
          - |
            cd coaster-blas
            cargo doc --no-deps
            cd -
            git clone doc-coaster-blas doc-coaster-blas-updated
            rm -rf doc-coaster-blas-updated/*
            cp -rf coaster-blas/target/doc/* doc-coaster-blas-updated/
            cd doc-coaster-blas-updated
            echo "<meta http-equiv=refresh content=0;url=coaster_blas/index.html>" > index.html
            git config --global user.email "sirmergealot@spearow.io"
            git config --global user.name "Sir Mergealot"
            git add -A && git commit -m"doc/automatic: update" || true
    - put: doc-coaster-blas
      params: { repository: doc-coaster-blas-updated, force: true }

  - name: doc-greenglas
    build_logs_to_retain: 2
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster
      - get: doc-greenglas
      - get: greenglas
        trigger: true
        passed: [test-greenglas]
      - get: container
        trigger: true
    - task: gen-doc
      image: container
      config:
        platform: linux
        inputs:
        - name: coaster
        - name: rust-blas
        - name: rust-cublas
        - name: rust-cudnn
        - name: greenglas
        - name: doc-greenglas
        outputs:
        - name: doc-greenglas-updated
        run:
          path: sh
          args:
          - -exc
          - |
            cd greenglas
            cargo doc --no-deps
            cd -
            git clone doc-greenglas doc-greenglas-updated
            rm -rf doc-greenglas-updated/*
            cp -rf greenglas/target/doc/* doc-greenglas-updated/
            cd doc-greenglas-updated
            echo "<meta http-equiv=refresh content=0;url=greenglas/index.html>" > index.html
            git config --global user.email "sirmergealot@spearow.io"
            git config --global user.name "Sir Mergealot"
            git add -A && git commit -m"doc/automatic: update" || true
    - put: doc-greenglas
      params: { repository: doc-greenglas-updated, force: true }

  - name: doc-juice
    build_logs_to_retain: 2
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster-blas
      - get: coaster-nn
      - get: coaster
        passed: [test-coaster]
      - get: doc-juice
      - get: juice
        trigger: true
        passed: [test-juice]
      - get: container
        trigger: true
    - task: gen-doc
      image: container
      config:
        platform: linux
        inputs:
        - name: coaster
        - name: coaster-nn
        - name: coaster-blas
        - name: rust-blas
        - name: rust-cublas
        - name: rust-cudnn
        - name: juice
        - name: doc-juice
        outputs:
        - name: doc-juice-updated
        run:
          path: sh
          args:
          - -exc
          - |
            cd juice
            cargo doc --no-deps
            cd -
            git clone doc-juice doc-juice-updated
            rm -rf doc-juice-updated/*
            cp -rf juice/target/doc/* doc-juice-updated/
            cd doc-juice-updated
            echo "<meta http-equiv=refresh content=0;url=juice/index.html>" > index.html
            git config --global user.email "sirmergealot@spearow.io"
            git config --global user.name "Sir Mergealot"
            git add -A && git commit -m"doc/automatic: update" || true
    - put: doc-juice
      params: { repository: doc-juice-updated, force: true }




  - name: test-rust-cudnn
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
        trigger: true



      - get: container-fedora-cuda
        trigger: true


















      tags: [cuda, nv-compute-cap-3.5]
    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cd cudnn-sys
            cargo b
            cargo t
            cd -
            cd cudnn
            cargo b
            cargo t
          dir: rust-cudnn
















  - name: test-rust-cublas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cublas
        trigger: true



      - get: container-fedora-cuda
        trigger: true


















      tags: [cuda, nv-compute-cap-3.5]
    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cublas
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cd cublas-sys
            cargo b
            cargo t
            cd -
            cd cublas
            cargo b
            cargo t
          dir: rust-cublas
















  - name: test-rust-blas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-blas
        trigger: true







      - get: container-fedora-native
        trigger: true







      - get: container-ubuntu-native
        trigger: true












    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo b
            cargo t

          dir: rust-blas







    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo b
            cargo t

          dir: rust-blas






  - name: test-coaster
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: coaster
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: coaster

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: coaster


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: coaster

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: coaster




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: coaster

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: coaster



  - name: test-coaster-blas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cublas
        trigger: true
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: coaster-blas
        trigger: true
      - get: rust-blas
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: coaster-blas

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: coaster-blas


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: coaster-blas

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: coaster-blas




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: coaster-blas

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: coaster-blas




  - name: test-coaster-nn
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
        trigger: true
      - get: rust-blas
        trigger: true
      - get: rust-cublas
        trigger: true
      - get: coaster
        passed: [test-coaster]
        trigger: true
      - get: coaster-blas
        trigger: true
      - get: coaster-nn
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: coaster-nn

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: coaster-nn


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: coaster-nn

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: coaster-nn




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: coaster-nn

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: coaster-nn



  - name: test-greenglas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: coaster-blas
        trigger: true
        passed: [test-coaster-blas]
      - get: coaster-nn
        trigger: true
        passed: [test-coaster-nn]
      - get: greenglas
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true


        passed: [test-coaster, test-coaster-nn, test-coaster-blas]


      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: greenglas

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: greenglas


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: greenglas

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: greenglas




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: greenglas

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: greenglas



  - name: test-juice
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: coaster-blas
        trigger: true
        passed: [test-coaster-blas]
      - get: coaster-nn
        trigger: true
        passed: [test-coaster-nn]
      - get: juice
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: juice

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: juice


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: juice

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: juice




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: juice

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: juice



  - name: test-juice-examples
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster-blas
      - get: coaster-nn
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: greenglas
        trigger: true
        passed: [test-greenglas]
      - get: juice
        trigger: true
        passed: [test-juice]
      - get: juice-examples
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: juice-examples

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: juice-examples


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: juice-examples

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: juice-examples




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: juice-examples

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: juice-examples


#################################


  - name: pr-test-rust-cudnn
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: pr-rust-cudnn
        trigger: true



      - get: container-fedora-cuda
        trigger: true


















      tags: [cuda, nv-compute-cap-3.5]
    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-rust-cudnn
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cd cudnn-sys
            cargo b
            cargo t
            cd -
            cd cudnn
            cargo b
            cargo t
          dir: pr-rust-cudnn
















  - name: pr-test-rust-cublas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: pr-rust-cublas
        trigger: true



      - get: container-fedora-cuda
        trigger: true


















      tags: [cuda, nv-compute-cap-3.5]
    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-rust-cublas
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cd cublas-sys
            cargo b
            cargo t
            cd -
            cd cublas
            cargo b
            cargo t
          dir: pr-rust-cublas
















  - name: pr-test-rust-blas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: pr-rust-blas
        trigger: true







      - get: container-fedora-native
        trigger: true







      - get: container-ubuntu-native
        trigger: true












    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-rust-blas
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo b
            cargo t

          dir: pr-rust-blas







    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-rust-blas
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo b
            cargo t

          dir: pr-rust-blas






  - name: pr-test-coaster
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: pr-coaster
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: pr-coaster

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: pr-coaster


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: pr-coaster

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: pr-coaster




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: pr-coaster

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: pr-coaster
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: pr-coaster



  - name: pr-test-coaster-blas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cublas
        trigger: true
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: pr-coaster-blas
        trigger: true
      - get: rust-blas
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: pr-coaster-blas

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: pr-coaster-blas


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: pr-coaster-blas

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: pr-coaster-blas




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: pr-coaster-blas

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: pr-coaster-blas




  - name: pr-test-coaster-nn
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
        trigger: true
      - get: rust-blas
        trigger: true
      - get: rust-cublas
        trigger: true
      - get: coaster
        passed: [test-coaster]
        trigger: true
      - get: coaster-blas
        trigger: true
      - get: pr-coaster-nn
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: pr-coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: pr-coaster-nn

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: pr-coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: pr-coaster-nn


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: pr-coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: pr-coaster-nn

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: pr-coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: pr-coaster-nn




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: pr-coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: pr-coaster-nn

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: pr-coaster-nn
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: pr-coaster-nn



  - name: pr-test-greenglas
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: coaster-blas
        trigger: true
        passed: [test-coaster-blas]
      - get: coaster-nn
        trigger: true
        passed: [test-coaster-nn]
      - get: pr-greenglas
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true


        passed: [test-coaster, test-coaster-nn, test-coaster-blas]


      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: pr-greenglas

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: pr-greenglas


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: pr-greenglas

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: pr-greenglas




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: pr-greenglas

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: greenglas
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: pr-greenglas



  - name: pr-test-juice
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: coaster-blas
        trigger: true
        passed: [test-coaster-blas]
      - get: coaster-nn
        trigger: true
        passed: [test-coaster-nn]
      - get: pr-juice
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: pr-juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: pr-juice

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: pr-juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: pr-juice


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: pr-juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: pr-juice

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: pr-juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: pr-juice




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: pr-juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: pr-juice

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: pr-juice
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: pr-juice



  - name: pr-test-juice-examples
    build_logs_to_retain: 4
    public: true
    serial: true
    plan:
    - aggregate:
      - get: rust-cudnn
      - get: rust-blas
      - get: rust-cublas
      - get: coaster-blas
      - get: coaster-nn
      - get: coaster
        trigger: true
        passed: [test-coaster]
      - get: greenglas
        trigger: true
        passed: [test-greenglas]
      - get: juice
        trigger: true
        passed: [test-juice]
      - get: pr-juice-examples
        trigger: true


      - get: container-fedora-cuda
        trigger: true

      - get: container-fedora-default
        trigger: true

      - get: container-fedora-native
        trigger: true

      - get: container-fedora-opencl
        trigger: true



      - get: container-ubuntu-native
        trigger: true

      - get: container-ubuntu-opencl
        trigger: true




      tags: [cuda, nv-compute-cap-3.5]

    - task: test-fedora-cuda
      image: container-fedora-cuda
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: pr-juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,cuda

          dir: pr-juice-examples

      tags: [cuda, nv-compute-cap-3.5, opencl]

    - task: test-fedora-default
      image: container-fedora-default
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: pr-juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test

          dir: pr-juice-examples


    - task: test-fedora-native
      image: container-fedora-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: pr-juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native

          dir: pr-juice-examples

      tags: [opencl]

    - task: test-fedora-opencl
      image: container-fedora-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: pr-juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            escalate
            prepare
            cargo test --no-default-features --features=native,opencl

          dir: pr-juice-examples




    - task: build-ubuntu-native
      image: container-ubuntu-native
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: pr-juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native

          dir: pr-juice-examples

      tags: [opencl]

    - task: build-ubuntu-opencl
      image: container-ubuntu-opencl
      privileged: true
      config:
        platform: linux
        inputs:
        - name: rust-cudnn
        - name: rust-blas
        - name: rust-cublas
        - name: coaster
        - name: coaster-blas
        - name: coaster-nn
        - name: juice
        - name: pr-juice-examples
        caches:
        - path: target
        run:
          path: sh
          args:
          - -exc
          - |
            prepare
            cargo build --no-default-features --features=native,opencl

          dir: pr-juice-examples


#################################
