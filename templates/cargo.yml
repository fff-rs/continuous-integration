                prepare
                cargo-override-injection
                export RUST_LOG=juice=debug
                export RUST_BACKTRACE=1
{%- if backend.execute == BackendExecute::Build -%}
{%- if backend.as_str() == "default" %}
                cargo build
{%- else if backend.as_str() == "native" %}
                cargo build --no-default-features --features=native
{%- else %}
                cargo build --no-default-features --features=native,{{ backend }}
{%- endif %}
{%- else -%}
{%- if backend.as_str() == "default" %}
                cargo test -- --nocapture
{%- else if backend.as_str() == "native" %}
                cargo test --no-default-features --features=native -- --nocapture
{%- else %}
                nvcc --version || $(fd cuda.h /usr/include | rg '#define CUDA_VERSION ') || echo "Failed to extract cuda version!"
                cargo test --no-default-features --features=native,{{ backend }} -- --nocapture
{%- endif %}
{%- endif -%}
