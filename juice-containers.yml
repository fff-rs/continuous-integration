resources:
- name: git-continuous-integration
  type: git
  source:
    branch: master
    uri: https://github.com/spearow/continuous-integration.git


- name: container-fedora-cuda
  type: docker-image
  tags: [cuda, nv-compute-cap-3.5]
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-cuda
    username: ((quay-username))
    password: ((quay-password))

- name: container-fedora-default
  type: docker-image
  tags: [cuda, nv-compute-cap-3.5, opencl]
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-default
    username: ((quay-username))
    password: ((quay-password))

- name: container-fedora-native
  type: docker-image
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-native
    username: ((quay-username))
    password: ((quay-password))

- name: container-fedora-opencl
  type: docker-image
  tags: [opencl]
  source:
    repository: quay.io/spearow/machine-learning-container-fedora-opencl
    username: ((quay-username))
    password: ((quay-password))



- name: container-ubuntu-native
  type: docker-image
  source:
    repository: quay.io/spearow/machine-learning-container-ubuntu-native
    username: ((quay-username))
    password: ((quay-password))

- name: container-ubuntu-opencl
  type: docker-image
  tags: [opencl]
  source:
    repository: quay.io/spearow/machine-learning-container-ubuntu-opencl
    username: ((quay-username))
    password: ((quay-password))



- name: container
  type: docker-image
  source:
    repository: quay.io/spearow/machine-learning-container
    username: ((quay-username))
    password: ((quay-password))



jobs:


  - name: build-fedora-cuda
    serial_groups: [constructors]
    build_logs_to_retain: 2
    plan:
    - aggregate:
      - get: ci
        resource: git-continuous-integration
        trigger: true
      - get: container
      params:
        build: container
        dockerfile: fedora/cuda/
        tag_as_latest: true

  - name: build-fedora-default
    serial_groups: [constructors]
    build_logs_to_retain: 2
    plan:
    - aggregate:
      - get: ci
        resource: git-continuous-integration
        trigger: true
      - get: container
      params:
        build: container
        dockerfile: fedora/default/
        tag_as_latest: true

  - name: build-fedora-native
    serial_groups: [constructors]
    build_logs_to_retain: 2
    plan:
    - aggregate:
      - get: ci
        resource: git-continuous-integration
        trigger: true
      - get: container
      params:
        build: container
        dockerfile: fedora/native/
        tag_as_latest: true

  - name: build-fedora-opencl
    serial_groups: [constructors]
    build_logs_to_retain: 2
    plan:
    - aggregate:
      - get: ci
        resource: git-continuous-integration
        trigger: true
      - get: container
      params:
        build: container
        dockerfile: fedora/opencl/
        tag_as_latest: true



  - name: build-ubuntu-native
    serial_groups: [constructors]
    build_logs_to_retain: 2
    plan:
    - aggregate:
      - get: ci
        resource: git-continuous-integration
        trigger: true
      - get: container
      params:
        build: container
        dockerfile: ubuntu/native/
        tag_as_latest: true

  - name: build-ubuntu-opencl
    serial_groups: [constructors]
    build_logs_to_retain: 2
    plan:
    - aggregate:
      - get: ci
        resource: git-continuous-integration
        trigger: true
      - get: container
      params:
        build: container
        dockerfile: ubuntu/opencl/
        tag_as_latest: true

